language: java

jdk:
  - oraclejdk7
  - oraclejdk8

env:
  - AS=wildfly81x
  #- AS=jboss71x
  - AS=jboss61x
  - AS=jboss51x
  - AS=jboss42x
  - AS=payara4x
  - AS=glassfish4x
  - AS=glassfish31x
  - AS=tomcat9x
  - AS=tomcat8x
  - AS=tomcat7x
  - AS=tomcat6x
  - AS=tomee16xweb
  - AS=tomee16xplus 
  - AS=wls12x
  - AS=wlp16x

matrix:  
  exclude:
    # http://stackoverflow.com/questions/22462936/will-it-be-possible-to-use-java-8-on-glassfish-3
    - jdk: oraclejdk8
      env: AS=glassfish31x
    # http://stackoverflow.com/questions/28496816/is-jdk8-a-supported-platform-for-jboss-6-as
    - jdk: oraclejdk8
      env: AS=jboss61x
    - jdk: oraclejdk8
      env: AS=jboss51x
    - jdk: oraclejdk8
      env: AS=jboss42x
    # gradle spawn plugin (mandatory for wls12x build) uses 1.8 source compatibility
    - jdk: oraclejdk7
      env: AS=wls12x
    # jdk8 required
    - jdk: oraclejdk7
      env: AS=tomcat9x
    # tomee arquilian integration has trouble with jdk 8 => skip it
    - jdk: oraclejdk8
      env: AS=tomee16xweb
    - jdk: oraclejdk8
      env: AS=tomee16xplus
  # until we fix websphere integration
  allow_failures:
    - jdk: oraclejdk7
      env: AS=wlp16x
    - jdk: oraclejdk8
      env: AS=wlp16x

before_install:
  - export ORG_GRADLE_PROJECT_container=${AS}
  - nvm install node && nvm use node # use the latest node version

before_script:
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
#  - sleep 3 # give xvfb some time to start

script: ./gradlew unitTest --info

notifications:
  email:
    - p6spy-developers@googlegroups.com

